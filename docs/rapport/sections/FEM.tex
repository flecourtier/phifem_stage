\section{Finite Element Methods (FEMs)}
\graphicspath{{images/FEM}}

In the following, we will consider the Poisson problem with Dirichlet condition (homogeneous or inhomogeneous):

\textbf{Problem :} Find $u : \Omega \rightarrow \mathbb{R}^d$ such that

\begin{equation*}
	\left\{
		\begin{aligned}
			-\Delta u &= f \; &&\text{in } \; \Omega \\
			u&=g \; &&\text{on } \; \partial\Omega
		\end{aligned}
	\right.
\end{equation*}

with $\Delta$ the Laplace operator and $\Omega\subset\mathbb{R}^d$ a lipschitzian bounded open set (and $\partial\Omega$ its boundary).

\textbf{Associated physical model :} Newtonian gravity, Electrostatics, Fluid dynamics...

\subsection{Standard FEM}

In this section, we will present the standard finite element method. We'll start by presenting some general notions of functional analysis, then explain the general principle of FEM. Then we'll give a few more details on the method and finish by describing the application to the Poisson problem (with Dirichlet condition).

\subsubsection{Some notions of functional analysis.}

\modif{AJOUTER : Déf Espace de Hilbert (+ ce qu'il faut pour def ça : Espace de Soboloev ? ... ) + Déf $L^2$,}

\subsubsection{General principle of the method}

Let's consider a domain $\Omega$ whose boundary is denoted $\partial\Omega$. We seek to determine a function $u$ defined on $\Omega$, solution of a partial differential equation (PDE) for given boundary conditions.

The general approach of the finite element method is to write down the variational formulation of this PDE, thus giving us a problem of the following type:

\textbf{Variational Problem :}
\begin{equation*}
	\text{Find } u\in V \text{ such that } a(u,v)=l(v), \;\forall v\in V
\end{equation*}

where $V$ is a Hilbert space, $a$ is a bilinear form and $l$ is a linear form.

To do this, we multiply the PDE by a test function $v\in V$, then integrate over $L^2(\Omega)$.

The idea of FEM is to use Galerkin's method. We then look for an approximate solution $u_h$ in $V_h$, a finite-dimensional space dependent on a positive parameter $h$ such that

\begin{equation*}
	V_h\subset V, \quad \dim V_h = N_h<\infty, \quad \forall h>0
\end{equation*}

The variational problem can then be approached by :

\textbf{Approach Problem :}
\begin{equation*}
	\text{Find } u_h\in V_h \text{ such that } a(u_h,v_h)=l(v_h), \;\forall v_h\in V
\end{equation*}

As $V_h$ is of finite dimension, we can consider a basis $(\varphi_1,\dots,\varphi_{N_h})$ of $V_h$ and thus decompose $u_h$ on this basis as :

\begin{equation}
	\label{decomp1}
	u_h=\sum_{i=1}^{N_h}u_i\varphi_i	
\end{equation}

The approached problem is then rewritten as

\begin{equation*}
	\text{Find } u_1,\dots,u_{N_h} \text{ such that } \sum_{i=1}^{N_h}u_i a(\varphi_i,v_h)=l(v_h), \;\forall v_h\in V 
\end{equation*}

and

\begin{equation*}
	\text{Find } u_1,\dots,u_{N_h} \text{ such that } \sum_{i=1}^{N_h}u_i a(\varphi_i,\varphi_j)=l(\varphi_j), \;\forall j\in \{1,\dots,N_h\}
\end{equation*}

Solving the PDE involves solving the following linear system:
\begin{equation*}
	AU=b
\end{equation*}
with
\begin{equation*}
	A=(a(\varphi_i,\varphi_j))_{1\le i,j\le N_h}, \quad U=(u_i)_{1\le i\le N_h} \quad \text{and} \quad b=(l(\varphi_j))_{1\le j\le N_h}
\end{equation*}

\subsubsection{Some details on FEM}

After having seen the general principle of FEM, it remains to define the $V_h$ spaces and the $\{\varphi_i\}$ basis functions.

\begin{Rem}
	The choice of $V_h$ space is fundamental to have an efficient method that gives a good approximation $u_h$ of $u$. In particular, the choice of the $\{\varphi_i\}$ basis of $V_h$ influences the structure of the $A$ matrix in terms of its sparsity and its condition number.
\end{Rem}

%\modif{Rajouter intro différentes notions abordées !}
%\trad{Pour ce faire, nous aurons besoin de plusieurs notions, qui seront détaillées dans les sections suivantes. Tout d'abord, nous aurons besoin de générer un \textbf{maillage} de notre domaine $\Omega$. Ainsi, nous pourrons résoudre l'EDP de manière discrète, en des points choisis. C'est alors qu'intervient la notion d'\textbf{éléments finis de Lagrange}. Les propriétés de ces éléments, notamment en terme de \textbf{famille affine d'élément fini} est un point clé de la méthode qui va nous permettre de ramener chaque élément du maillage à un \textbf{élément de référence} à l'aide d'une \textbf{transformation géométrique}.}

To do this, we'll need several notions, which will be detailed in the following sections. First, we'll need to generate a \textbf{mesh} of our $\Omega$ domain. This will enable us to solve the PDE discretely at selected points. This is where the notion of \textbf{finite Lagrange elements} comes in. The properties of these elements, particularly in terms of their \textbf{affine family of finite elements}, is a key point of the method, which will enable us to bring each element of the mesh back to a \textbf{reference element} by using a \textbf{geometric transformation}. To describe these steps, we'll need to know 2 basic concepts: the \textbf{\modif{unisolvance}} principle and the definitions of the \textbf{polynomial spaces} used ($\mathbb{P}_k$ and $\mathbb{Q}_k$).

\paragraph{Unisolvance}

\begin{Def}
	Let $\Sigma=\{a_1,\dots,a_N\}$ be a set of $N$ distinct points of $\mathbb{R}^n$. Let $P$ be a finite-dimensional vector space of $\mathbb{R}^n$ functions taking values in $\mathbb{R}$. We say that $\Sigma$ is $P$-\modif{unisolvent} if and only if for all real $\alpha_1,\dots,\alpha_N$, there exists a unique element $p$ of $P$ such that $p(a_i)=\alpha_i,i=1,\dots,N$. 
	This means that the function
	\begin{align*}
		L \; : \; P &\rightarrow \mathbb{R}^N \\
		p &\mapsto(p(a_1),\dots,p(a_N))
	\end{align*}
	is bijective.
\end{Def}

\begin{Rem}
	In practice, to show that $\Sigma$ is $P$-\modif{unisolvent}, we simply check that $\dim P= \text{card } (\Sigma)$ and then prove the injectivity or surjectivity of $L$. The injectivity of $L$ is demonstrated by showing that the only function of $P$ that annuls on all points of $\Sigma$ is the null function. The surjectivity of $L$ is shown by identifying a family $p_1,\dots,p_N$ of elements of $P$ such that $p_i(a_j)=\delta_{ij}$. Given real $\alpha_1,\dots,\alpha_N$, the function $p=\sum_{i=1}^N\alpha_i p_i$ then verifies $p(a_j)=\alpha_j,j=1\dots,N$. 
\end{Rem}

\begin{Rem}
	We call local basis functions of element $K$ the $N$ functions $p_1,\dots,p_N$ of $P$ such that
	\begin{equation*}
		p_i(a_j)=\delta_{ij},\quad 1\le i,j\le N
	\end{equation*}
\end{Rem}

\paragraph{Polynomial space}

Let $\mathbb{P}_k$ be the vector space of polynomials of total degree less than or equal to $k$.

\begin{enumerate}[label=\textbullet]
	\item In $\mathbb{R}$ : $\mathbb{P}_k=\text{Vect}\{1,X,\dots,X^k\}$ and $\dim\mathbb{P}_k=k+1$ 
	\item In $\mathbb{R}^2$ : $\mathbb{P}_k=\text{Vect}\{X^iY^j,0\le i+j\le k\}$ and $\dim\mathbb{P}_k=\frac{(k+1)(k+2)}{2}$
	\item In $\mathbb{R}^3$ : $\mathbb{P}_k=\text{Vect}\{1,X^iY^jZ^l,0\le i+j+l\le k\}$ and $\dim\mathbb{P}_k=\frac{(k+1)(k+2)(k+3)}{6}$
\end{enumerate}

Let $\mathbb{Q}_k$ be the vector space of polynomials of degree less than or equal to $k$ with respect to each variable.

\begin{enumerate}[label=\textbullet]
	\item In $\mathbb{R}$ : $\mathbb{Q}_k=\mathbb{P}_k$. 
	\item In $\mathbb{R}^2$ : $\mathbb{Q}_k=\text{Vect}\{X^iY^j,0\le i,j\le k\}$ and $\dim\mathbb{Q}_k=(k+1)^2$
	\item In $\mathbb{R}^3$ : $\mathbb{Q}_k=\text{Vect}\{1,X^iY^jZ^l,0\le i,j,l\le k\}$ and $\dim\mathbb{Q}_k=(k+1)^3$
\end{enumerate}

\paragraph{Finite Lagrange Element}

The most classic and simplest type of finite element is the Lagrange finite element.

\begin{Def}[Lagrange Finite Element]
	A finite Lagrange element is a triplet $(K,\Sigma,P)$ such that 
	\begin{enumerate}[label=\textbullet]
		\item $K$ is a geometric element of $\mathbb{R}^n$ ($n=1,2$ or $3$), compact, connected and of non-empty interior.
		\item $\Sigma=\{a_1,\dots,a_N\}$ is a finite set of $N$ distinct points of $K$.
		\item $P$ is a finite-dimensional vector space of real functions defined on $K$ and such that $\Sigma$ is $P$-\modif{unisolvent} (so $\dim P=N$).
	\end{enumerate}
\end{Def}

\begin{Example}
	Let $K$ be the segment $[a_1,a_2]$. Let's show that $\Sigma=\{a_1,a_2\}$ is $P$-\modif{unisolvent} for $P=\mathbb{P}^1$. Since $\{1,x\}$ is a base of $\mathbb{P}^1$, we have $\dim P = \text{card } \Sigma = 2$. 
	
	Moreover, we can write $p_i=\alpha_i x+\beta_i, i=1,2$. Thus
	\begin{equation*}
		\left\{\begin{aligned}
			&p_1(a_1)=1 \\
			&p_1(a_2)=0
		\end{aligned}\right. \quad \iff	\quad
		\left\{\begin{aligned}
			&\alpha_1 a_1+\beta_1=1 \\
			&\alpha_1 a_2+\beta_1=0
		\end{aligned}\right. \quad \iff \quad
		\left\{\begin{aligned}
		&\alpha_1 = \frac{1}{a_1-a_2} \\
		&\beta_1 = -\frac{a_2}{a_1-a_2}
	\end{aligned}\right.
	\end{equation*}
	and
	\begin{equation*}
		\left\{\begin{aligned}
			&p_2(a_1)=0 \\
			&p_2(a_2)=1
		\end{aligned}\right. \quad \iff	\quad
		\left\{\begin{aligned}
			&\alpha_2 a_1+\beta_2=0 \\
			&\alpha_2 a_2+\beta_2=1
		\end{aligned}\right. \quad \iff \quad
		\left\{\begin{aligned}
			&\alpha_1 = \frac{1}{a_2-a_1} \\
			&\beta_1 = -\frac{a_1}{a_2-a_1}
		\end{aligned}\right.
	\end{equation*}
	Thus
	\begin{equation*}
		p_1(x)=\frac{x-a_2}{a_1-a_2} \quad \text{and} \quad p_2(x)=\frac{x-a_1}{a_2-a_1}
	\end{equation*}
	We deduce the surjectivity of $L$ and $\Sigma$ is $\mathbb{P}^1$-\modif{unisolvent}. 
	
	Thus $(K,\Sigma,P)$ is a Lagrange Finite Element.
	\end{Example}

	\begin{Def}
		Two finite elements $(\hat{K},\hat{\Sigma},\hat{P})$ and $(K,\Sigma,P)$ are affine-equivalent if and only if there exists an inversible affine function $F$ such that
		\begin{enumerate}[label=\textbullet]
			\item $K=F(\hat{K})$
			\item $a_i=F(\hat{a_i}),i=1,\dots,N$ 
			\item $P=\{\hat{p}\circ F^{-1},\hat{p}\in\hat{P}\}$.
		\end{enumerate}
		We then call an \textbf{affine family of finite elements} a family of finite elements, all affine-equivalent to the same element $(\hat{K},\hat{\Sigma},\hat{P})$, called the \textbf{reference element}.
	\end{Def}

	\begin{Rem}
		Let $(\hat{K},\hat{\Sigma},\hat{P})$ and $(K,\Sigma,P)$ be two affine-equivalent finite elements, via an $F$ transformation. Let $\hat{p_i}$ be the local basis functions on $\hat{K}$. Then the local basis functions on $K$ are $p_i=\hat{p_i}\circ F^{-1}$.
	\end{Rem}
		
	\begin{Rem}
		In practice, working with an affine family of finite elements means that all integral calculations can be reduced to calculations on the reference element. 
		
		The reference elements in 1D, 2D triangular and 3D tetrahedral are :
		\begin{figure}[H]
			\centering
			\includegraphics[width=0.8\linewidth]{"FEM_reference_element.png"}
			\captionof{figure}{Example of reference Elements}
		\end{figure}
	\end{Rem}

\paragraph{Mesh}

In 1D, the construction of a mesh consists in creating a subdivision of the interval $[a,b]$. We can extend this definition in 2D and 3D by considering that a mesh is formed by a family of elements (see Fig~\ref{triangle_mesh}):
\begin{equation*}
	\mathcal{T}_h = \left\{K_1,\dots,K_{N_e}\right\}
\end{equation*} 
where $N_e$ is the number of elements. 

In 2D, these elements can be triangles or rectangles. In 3D, they can be tetrahedrons, parallelepipeds or prisms.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.3\linewidth]{"FEM_triangle_mesh.png"}
	\captionof{figure}{Example of a triangular mesh on a circles}
	\label{triangle_mesh}
\end{figure}

\paragraph{Geometric transformation}

A mesh is generated by
\begin{enumerate}[label=\textbullet]
	\item A reference element noted $\hat{K}$.
	\item A family of geometric transformations mapping $\hat{K}$ to the elements $\left\{K_1,\dots,K_{N_e}\right\}$. Thus, for a cell $K\in\mathcal{T}_h$, we denote $T_K$ the geometric transformation mapping $\hat{K}$ to $K$ :
	\begin{equation*}
	T_K : \hat{K}\rightarrow K
	\end{equation*}
\end{enumerate}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\linewidth]{"FEM_geometric_trans.png"}
	\captionof{figure}{Geometric transformation applied to a triangle}
	\label{trans_geo}
\end{figure}

Let $(\hat{K},\hat{\Sigma},\hat{P})$ be the finite reference element with 
\begin{enumerate}[label=\textbullet]
	\item the nodes of the reference element $\hat{K}$ : $\hat{\Sigma}=\{\hat{a}_1,\dots,\hat{a}_n\}$
	\item the local base functions of $\hat{K}$: $\{\hat{\psi}_1,\dots,\hat{\psi}_n\}$ (also called form functions)
\end{enumerate}

So for each $K\in\mathcal{T}_h$, we consider a tuple $\{a_{K,1},\dots,a_{K,n}\}$ (degrees of freedom) and the associated geometric transformation is defined by :
\begin{equation*}
	T_K : \hat{x}\mapsto\sum_{i=1}^{n}a_{K,i}\hat{\psi}_i(\hat{x})
\end{equation*}

In particular, we have
\begin{equation*}
	T_K(\hat{a_i})=a_{K,i}, \quad i=1,\dots,n
\end{equation*}

\begin{Rem}
	In particular, if the form functions are affine, the geometric transformations will be too. This is an interesting property, as the gradient of these geometric transformations will be constant.
\end{Rem}

\textbf{Construction of the basis $(\varphi_i)$ of $V_h$ :}

\modif{TO COMPLETE !}

\begin{Rem}
	In the following, we'll assume that these transformations are $C^1$-diffeomorphisms (i.e. the transformation and its inverse are $C^1$ and bijective).
\end{Rem}

\subsubsection{Application to the Poisson problem}

\modif{2 sous-sections ? -> Théorie -> Pratique}

\modif{Ajouter formulation variationnel Poisson}

\begin{Prop}[Lax-Milgram]
	
	Let $a$ be a continuous, coercive bilinear form on $V$ and $l$ a continuous, linear form on $V$. Then the variational problem has a unique solution $u\in V$. 
	
	Moreover, if the bilinear form is symmetrical, $u$ is a solution to the following minimization problem:
	\begin{equation*}
		J(u)=\min_{v\in V} J(v), \quad J(v)=\frac{1}{2}a(v,v)-l(v)
	\end{equation*}
\end{Prop}

It can then be shown that the Poisson problem with Dirichlet condition has a unique weak solution \modif{$u\in H_0^1(\Omega)$}.

\modif{rajouter preuve}


\modif{Rajouter : Calcul assemblage matrice dans le cas de ce problème ?}

\modif{Rajouter : Convergence FEM standard !}

\newpage

\subsection{$\phi$-FEM}

In this section, we will present the $\phi$-FEM method. We will first present the context in which the method is used and its general principle, then go into a little more detail about the method in the case of the Poisson problem with Dirichlet condition. \modif{Finally, we will present the main numerical results of the reference article ?}

\subsubsection{Context and general principle of the method}

The PhiFEM method is a new fictitious domain finite element method that does not require a boundary mesh. In the context of augmented surgery, this method presents a considerable advantage. During real-time simulation, the geometry (in our specific context, an organ such as the liver, for example) can deform over time. Methods such as standard FEM, which requires a mesh fitted to the boundary, necessitate a complete remeshing of the geometry at each time step. Unlike this type of method, $\phi$-FEM requires only the generation of a single mesh: the mesh of a fictitious domain containing the entire geometry. As the boundary of the geometry is represented by a levelset function $\phi$, only this function will change over time, which is a real time-saver.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.7\linewidth]{"PhiFEM_context.png"}
	\captionof{figure}{Left: active meshes for $\phi$-FEM (with cells from $\mathcal{T}_h^\Gamma$ in yellow). Right: a fitted mesh for the standard FEM. (\modif{add ref})}
	\label{context}
\end{figure}

\begin{Rem}
	For the purposes of this internship, the geometries considered are not organs (such as the liver), because these are complex geometries. We'll be considering simpler geometries such as circles or squares. It's also important to note that the $\phi$-FEM method has a considerable advantage: by constructing a fictitious mesh around the domain, we can generate a Cartesian mesh. This type of mesh can easily be represented by matrices, in the same way as images, hence the possibility of teaching these $\phi$-FEM solutions to an FNO who generally works on images. \modif{Un article récent présente des résultats avec la combinaison de PhiFEM et d'un FNO sur des géométries d'ellipse + add ref si publié avant rendu.}
\end{Rem}

\subsubsection{General presentation of the $\phi$-FEM method}

In this section, we consider the case of the Poisson problem with homogeneous Dirichlet condition ($g=0$ on $\Gamma$). For the case of non-homogeneous Dirichlet conditions, we'll give more details in Section \ref{FEM.details}. For more details on mesh assumptions, convergence results and finite element matrix condition number, please refer to \modif{ref 12,8,10,19}. Models $\phi$-FEM for the Poisson problem with Neumann or mixed conditions (Dirichlet and Neumann) are presented in \modif{ref ...}. For consideration of the elasticity problem, please refer to \modif{ref ...}.

\paragraph{Description of spaces} 

%\label{FEM.phifem.description_spaces}

We will consider the Poisson-Dirichlet problem
\begin{equation*}
	\left\{
	\begin{aligned}
		-\Delta u &= f, \; &&\text{in } \; \Omega, \\
		u&=g, \; &&\text{on } \; \partial\Omega,
	\end{aligned}
	\right.
\end{equation*}

where the domain $\Omega$ and its boundary $\Gamma$ are given by a level-set function $\phi$ such that
\begin{equation*}
	\Omega=\{\phi < 0\} \quad \text{and} \quad \Gamma=\{\phi = 0\}.
\end{equation*}

The level-set function $\phi$ is supposed to be known on $\mathbb{R}^d$, smooth, and to behave near $\Gamma$ as the signed distance to $\Gamma$ (Figure \ref{space1}). 

\begin{figure}[H]
	\centering
	\includegraphics[width=0.4\linewidth]{"PhiFEM_level_set.png"}
	\captionof{figure}{Definition of the level-set function}
	\label{space1}
\end{figure}

\begin{Example}
	If $\Omega$ is a circle of center $A$ and radius $r$, the level-set function can be defined by
	\begin{equation*}
		\phi(x,y)=-r^2+(x-x_A)^2+(y-y_A)^2.
	\end{equation*}
	If $\Omega$ is an ellipse with center $A$ and parameter $(a,b)$, the level-set function can be defined by
	\begin{equation*}
		\phi(x,y)=-1+\frac{(x-x_A)^2}{a^2}+\frac{(y-y_A)^2}{b^2}.
	\end{equation*}
\end{Example}

We assume that $\Omega$ is inside a domain $\mathcal{O}$ and we introduce a simple quasi-uniform mesh $\mathcal{T}_h^\mathcal{O}$ on $\mathcal{O}$ (Figure \ref{space2}).
 
We will consider $\mathcal{T}_h$ a sub-mesh of $\mathcal{T}_h^\mathcal{O}$ obtained by removing the elements located entirely outside $\Omega$ (Figure \ref{space3}). To be more specific, $\mathcal{T}_h$ is defines by
\begin{equation*}
	\mathcal{T}_h=\left\{T\in \mathcal{T}_h^\mathcal{O}:T\cap\{\phi_h<0\}\ne\emptyset\right\}.
\end{equation*}
We note $\Omega_h$ the domain covered by the $\mathcal{T}_h$ mesh ($\Omega_h$ will be slightly larger than $\Omega$) and $\partial\Omega_h$ its boundary (Figure \ref{space3}). The domain $\Omega_h$ is defined by
\begin{equation*}
	\Omega_h=\left(\cup_{T\in\mathcal{T}_h}T\right)^O
\end{equation*}

\begin{minipage}{0.52\linewidth}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.85\linewidth]{"PhiFEM_domain.png"}
		\captionof{figure}{Fictitious domain}
		\label{space2}
	\end{figure}
\end{minipage} \;
\begin{minipage}{0.44\linewidth}
	\begin{figure}[H]
		\centering
		\includegraphics[width=\linewidth]{"PhiFEM_domain_considered.png"}
		\captionof{figure}{Domain considered}
		\label{space3}
	\end{figure}
\end{minipage}

Now, we can introduce an approximation $\phi_h\in V_{h,\mathcal{O}}^{(l)}$ of $\phi$ given by $\phi_h=I_{h,\mathcal{O}}^{(l)}(\phi)$ where $I_{h,\mathcal{O}}^{(l)}$ is the standard Lagrange interpolation operator on
\begin{equation*}
	V_{h,\mathcal{O}}^{(l)}=\left\{v_h\in H^1(\mathcal{O}):v_{h|_T}\in\mathbb{P}_l(T) \;  \forall T\in\mathcal{T}_h^\mathcal{O}\right\}.
\end{equation*}
By considering $\Gamma_h=\{\phi_h=0\}$, the approximate boundary of $\Gamma$, we can introduce $\mathcal{T}_h^\Gamma\subset \mathcal{T}_h$ (Figure \ref{space4}) which contains the mesh elements cut by the
approximate boundary $\Gamma_h = \{\phi_h=0\}$, i.e. 
\begin{equation*}
	\mathcal{T}_h^\Gamma=\left\{T\in \mathcal{T}_h:T\cap\Gamma_h\ne\emptyset\right\}.
\end{equation*}
and $\mathcal{F}_h^\Gamma$ (Figure \ref{space5}) collects the interior facets of the mesh $\mathcal{T}_h$ either cut by $\Gamma_h$ or belonging to a cut mesh element
\begin{equation*}
	\mathcal{F}_h^\Gamma=\left\{E\;(\text{an internal facet of } \mathcal{T}_h) \text{ such that } \exists T\in \mathcal{T}_h:T\cap\Gamma_h\ne\emptyset \text{ and } E\in\partial T\right\}.
\end{equation*}
We denote by $\Omega_h^\Gamma$ the domain covered by the $\mathcal{T}_h^\Gamma$ mesh (Figure \ref{space4}) and also defined by
\begin{equation*}
	\Omega_h^\Gamma=\left(\cup_{T\in\mathcal{T}_h^\Gamma}T\right)^O
\end{equation*}

\begin{minipage}{0.48\linewidth}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.9\linewidth]{"PhiFEM_boundary_cells.png"}
		\captionof{figure}{Boundary cells}
		\label{space4}
	\end{figure}
\end{minipage} \;
\begin{minipage}{0.48\linewidth}
	\begin{figure}[H]
		\centering
		\includegraphics[width=0.9\linewidth]{"PhiFEM_boundary_edges.png"}
		\captionof{figure}{Boundary edges}
		\label{space5}
	\end{figure}
\end{minipage}

\paragraph{Description of the $\phi$-FEM method}

As with standard FEM, the general idea behind $\phi$-FEM is to find a weak solution (i.e. a solution to the variational problem) to the Poisson problem in question. The main difference lies in the spaces considered. In fact, we're no longer looking to solve the problem on $\Omega$ (of boundary $\Gamma$) but on $\Omega_h$ (of boundary $\partial\Omega_h$). Since our boundary conditions are defined on $\Gamma$, we don't have a direct condition on the $\partial\Omega_h$ boundary, so we'll have to add terms to the variational formulation of the problem, called stabilization terms.

Assuming that the right-hand side $f$ is currently well-defined on $\Omega_h$ and that the solution $u$ can be extended on $\Omega_h$ such that $-\Delta u=f$ on $\Omega_h$, we can introduce a new unknown $w\in H^1(\Omega_h)$ such that $u=\phi w$ and the boundary condition on $\Gamma$ is satisfied. After integration by parts, we have
\begin{equation*}
	\int_{\Omega_h}\nabla(\phi w)\cdot\nabla(\phi v)-\int_{\partial\Omega_h}\frac{\partial}{\partial n}(\phi w)\phi v=\int_{\Omega_h} f\phi v,\quad \forall v\in H^1(\Omega_h)
\end{equation*}
\begin{Rem}
	Note that $\Omega_h$ is constructed using $\phi_h$ and therefore implicitly depends on $\phi$.
\end{Rem}
Given an approximation $\phi_h$ of $\phi$ on the mesh $\mathcal{T}_h$, as defined in Section \modif{ADD paragraph label antora}, and a finite element space $V_h$ on $\mathcal{T}_h$, we can then search for $w_h\in V_h$ such that
\begin{equation*}
	a_h(w_h,v_h)=l_h(v_h), \quad \forall v_h\in V_h.
\end{equation*}
We can consider the finite element space $V_h=V_h^{(k)}$ with
\begin{equation*}
	V_h^{(k)}=\left\{v_h\in H^1(\Omega_h):v_{h|_T}\in\mathbb{P}_k(T) \;  \forall T\in\mathcal{T}_h\right\}.
\end{equation*}
The bilinear form $a_h$ and the linear form $l_h$ are defined by
\begin{equation*}
	a_h(w,v)=\int_{\Omega_h} \nabla (\Phi_h w) \cdot \nabla (\Phi_h v) - \int_{\partial\Omega_h} \frac{\partial}{\partial n}(\Phi_h w)\Phi_h v+G_h(w,v)
\end{equation*}
and
\begin{equation*}
	l_h(v)=\int_{\Omega_h} f \Phi_h v + G_h^{rhs}(v)
\end{equation*}
with
\begin{equation*}
G_h(w,v)=\sigma h\sum_{E\in\mathcal{F}_h^\Gamma} \int_E \left[\frac{\partial}{\partial n}(\Phi_h w)\right] \left[\frac{\partial}{\partial n}(\Phi_h v)\right]+\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma} \int_{T} \Delta(\Phi_h w)\Delta(\Phi_h v)
\end{equation*}
and
\begin{equation*}
G_h^{rhs}(v)=-\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma} \int_{T} f \Delta(\Phi_h v).
\end{equation*}
$\sigma$ is an independent parameter of h, which we'll call the stabilization parameter.

\begin{Rem}
	Note that $[\;\cdot\;]$ is the jump on the interface $E$ defined by
	\begin{equation*}
		\left[\frac{\partial}{\partial n}(\phi_h w)\right]=\nabla(\phi_h w)^+\cdot n - \nabla(\phi_h w)^-\cdot n
	\end{equation*}
with $n$ is the unit normal vector outside $E$.
\end{Rem}

\subsubsection{Some details on $\phi$-FEM} \label{FEM.details}

\paragraph{Stabilization terms}    

As introduced previously, the stabilization terms are intended to reduce the errors created by the "fictitious" boundary, but they also have the effect of ensuring the correct condition number of the finite element matrix and permitting to restore the coercivity of the bilinear scheme.                                                                                      

The first term of $G_h(w,v)$ defined by
\begin{equation*}
	\sigma h\sum_{E\in\mathcal{F}_h^\Gamma} \int_E \left[\frac{\partial}{\partial n}(\Phi_h w)\right] \left[\frac{\partial}{\partial n}(\Phi_h v)\right]
\end{equation*}
is a first-order stabilization term. This stabilization term is based on the idea of a ghost penalty taken from the article \modif{add E. Burman. Ghost Penality ref.}. It also ensures the continuity of the solution by penalizing gradient jumps.

By substracting $G_h^{rhs}(v)$ from the second term of $G_h(w,v)$, i.e.
\begin{equation*}
	\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma} \int_{T} \Delta(\Phi_h w)\Delta(\Phi_h v)+\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma} \int_{T} f \Delta(\Phi_h v),
\end{equation*}
which can be rewritten as
\begin{equation*}
	\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma} \int_{T} \left(\Delta(\Phi_h w)+f\right)\Delta(\Phi_h v),
\end{equation*}
we recognize the strong formulation of the Poisson problem. This second-order stabilization term penalizes the scheme by requiring the solution to verify the strong form on $\Omega_h^\Gamma$. In fact, this term cancels out if $\phi_h w$ is the exact solution of the Poisson problem under consideration.

\paragraph{Non-homogeneous case}

In the case of a non-homogeneous Dirichlet condition, we want to impose $u=g$ on $\Gamma$. To do this, we'll consider 2 approaches introduced in \modif{add ref elasticity} and presented below:

\begin{enumerate}[label=\textbullet]
	\item \textbf{Direct method :} In this method, we must suppose that $g$ is currently given over the entire $\Omega_h$ and not just over $\Gamma$. We can then write the solution $u$ as
	\begin{equation*}
		u=\phi w +g, \; \text{on } \Omega_h.
	\end{equation*}
	It can then be injected into the weak formulation of the homogeneous problem and we can then search for $w_h$ on $\Omega_h$ such that
	\begin{align*}
		\int_{\Omega_h}\nabla(\phi_h w)\nabla(\phi_h v)-\int_{\partial\Omega_h}\frac{\partial}{\partial n}(\phi_h w)&\phi_h v+G_h(w,v)=\int_{\Omega_h}f\phi_h v \\
		&-\int_{\Omega_h}\nabla g\nabla(\phi_h v)+\int_{\partial\Omega_h}\frac{\partial g}{\partial n}\phi_h v+G_h^{rhs}(v), \; \forall v\in \Omega_h
	\end{align*}
	with
	\begin{equation*}
		G_h(w,v)=\sigma h\sum_{E\in\mathcal{F}_h^\Gamma}\int_E\left[\frac{\partial}{\partial n}(\phi_h w)\right]\left[\frac{\partial}{\partial n}(\phi_h v)\right]+\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma}\int_T \Delta(\phi_h w)\Delta(\phi_h v)
	\end{equation*}
	and
	\begin{equation*}
		G_h^{rhs}(v)=-\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma}\int_T f\Delta(\phi_h v)-\sigma h\sum_{E\in\mathcal{F}_h^\Gamma}\int_E\left[\frac{\partial g}{\partial n}\right]\left[\frac{\partial}{\partial n}(\phi_h v)\right]-\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma}\int_T \Delta g\Delta(\phi_h v)
	\end{equation*}
	\item \textbf{Dual method :} We now assume that $g$ is defined on $\Omega_h^\Gamma$ and not on $\Omega_h$. We then introduce a new unknown $p$ on $\Omega_h^\Gamma$ in addition to the unknown $u$ on $\Omega_h$ and so we aim to impose
	\begin{equation*}
		u=\phi p+g, \; \text{on } \Omega_h^\Gamma.
	\end{equation*}
	So we look for $u$ on $\Omega_h$ and $p$ on $\Omega_h^\Gamma$ such that
	\begin{align*}
		\int_{\Omega_h}\nabla u\nabla v-\int_{\partial\Omega_h}\frac{\partial u}{\partial n} v + \frac{\gamma}{h^2} \sum_{T\in\mathcal{T}_h^\Gamma}\int_T &\left(u-\frac{1}{h}\phi p\right)\left(v-\frac{1}{h}\phi q\right) + G_h(u,v) = \int_{\Omega_h}fv \\
		&+ \frac{\gamma}{h^2} \sum_{T\in\mathcal{T}_h^\Gamma}\int_T g\left(v-\frac{1}{h}\phi q\right) + G_h^{rhs}(v), \; \forall v \; \text{on } \Omega_h, \; q \; \text{on } \Omega_h^\Gamma.
	\end{align*}
	with $\gamma$ an other positive stabilization parameter,
	\begin{equation*}
		G_h(u,v)=\sigma h\sum_{E\in\mathcal{F}_h^\Gamma}\int_E\left[\frac{\partial u}{\partial n}\right]\left[\frac{\partial v}{\partial n}\right]+\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma}\int_T \Delta u\Delta v
	\end{equation*}
	and
	\begin{equation*}
		G_h^{rhs}(v)=-\sigma h^2\sum_{T\in\mathcal{T}_h^\Gamma}\int_T f\Delta v.
	\end{equation*}
	\begin{Rem}
		The factors $\frac{1}{h}$ and $\frac{1}{h^2}$ control the condition number of the finite element matrix. For more details, please refer to the article \modif{ADD Art 14 de art sur dual}.
	\end{Rem}
\end{enumerate}