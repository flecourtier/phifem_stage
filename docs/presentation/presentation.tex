%% Requires compilation with XeLaTeX or LuaLaTeX
\documentclass[compress,10pt,xcolor={table,dvipsnames},t]{beamer}
%\documentclass[compress]{beamer}
\usetheme{diapo}
\usepackage{amsmath}
\usepackage[bottom]{footmisc}
\usepackage{multirow}
\usepackage{setspace}
\usepackage{caption}
\usepackage{array,multirow,makecell}
\usepackage[table]{xcolor}
\usepackage{pifont}
\usepackage{hyperref}
\usepackage[utf8]{inputenc}
\setcellgapes{1pt}
\setlength{\parindent}{0pt}
\makegapedcells
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash }b{#1}}
\newcolumntype{L}[1]{>{\raggedright\arraybackslash }b{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash }b{#1}}
\usepackage{paralist}

\usepackage[backend=biber,style=numeric,sorting=nyt]{biblatex}
\renewcommand*{\bibfont}{\scriptsize}
\addbibresource{biblio.bib}

\hypersetup{
	colorlinks=true,
	urlcolor=blue,
	citecolor=blue,
	linkcolor=titre,
}

\title[PhiFEM]{Innovative non-conformal finite element methods for augmented surgery}
\subtitle{Internship presentation}
\author[name]{Author : LECOURTIER Frédérique \\ Supervisors : DUPREZ Michel, FRANCK Emmanuel, LLERAS Vanessa}
\institute{\large Strasbourg University}
\date{\today}

\useoutertheme[subsection=false]{miniframes}
\usepackage{etoolbox}
\makeatletter
\patchcmd{\slideentry}{\advance\beamer@xpos by1\relax}{}{}{}
\def\beamer@subsectionentry#1#2#3#4#5{\advance\beamer@xpos by1\relax}%
\makeatother

\allowbreak

\begin{document}
	\nocite{*}
	
	\begin{frame}
		\vspace{-20pt}
		\titlepage
	\end{frame}
	
	\AtBeginSection[]{
		\begin{frame}
			\vfill
			\centering
			\begin{beamercolorbox}[sep=5pt,shadow=true,rounded=true]{subtitle}
				\usebeamerfont{title}\insertsectionhead\par%
			\end{beamercolorbox}
			%\tableofcontents[sectionstyle=hide,subsectionstyle=show]
			\tableofcontents[sectionstyle=hide,subsectionstyle=show/shaded/hide]
			\vfill
		\end{frame}
	}

	\AtBeginSubsection[]{
		\begin{frame}
			\vfill
			\centering
			\begin{beamercolorbox}[sep=5pt,shadow=true,rounded=true]{subtitle}
				\usebeamerfont{title}\insertsectionhead\par%
			\end{beamercolorbox}
			\tableofcontents[sectionstyle=hide,subsectionstyle=show/shaded/hide]
			\vfill
		\end{frame}
	}

	\section{Introduction}

	\begin{frame}{Presentation of the teams}
		\begin{center}
			\pgfimage[width=0.3\linewidth]{images/intro/logo-mimesis.png}
		\end{center}
		\begin{enumerate}[\ding{217}]
			\item project-team Inria affiliated with MLMS ("Machine Learning, Modélisation et Simulation") and with the Inria Nancy Center.
			\item \textbf{Aim :} to create real-time digital twins of an organ
			\item \textbf{Scientific challenges :}
			\begin{itemize}
				\item scientific computing
				\item data assimilation
				\item machine learning
				\item control
			\end{itemize}
			\item \textbf{Main application domains :}
			\begin{itemize}
				\item surgical training
				\item surgical guidance during complex interventions
			\end{itemize}
		\end{enumerate}
	\end{frame}

	\begin{frame}{Scientific context}
		\textbf{Abstract :} Mimesis propose a new fictitious domain finite element method, the $\phi$-FEM Method, given by a level-set function without requiring a mesh fitting the boundary. 
		
		\begin{enumerate}[\ding{217}]
			\item Fictitious domain methods allow to mesh complex geometries to ensure geometric quality (such as organs like the liver)
			\item Cartesian grid adapted for neural networks
			\item \textit{Practical case:} Real-time simulation, form optimization
		\end{enumerate}
		
		\begin{center}
			\pgfimage[width=0.8\linewidth]{images/intro/context_geometry.png}
		\end{center}		
	\end{frame}

	\begin{frame}{Objectives - Deliverables}
		\textbf{Objective :} Correct and certify the prediction of a Fourier Neural Operator (FNO)
		
		\textbf{Tools :} 
		
		\begin{enumerate}[\ding{217}]
			\item the $\phi$-FEM method (to be adapted for our purpose) 
			\item the FNO implementation by Vincent Vigon with Tensorflow.
		\end{enumerate}
		
		\textbf{Deliverables :}

		\begin{enumerate}[\ding{217}]
			\item a \href{https://github.com/flecourtier/phifem_stage/blob/main/docs/suivi/suivi.pdf}{weekly tracking report} (in French)
			\item a \href{https://github.com/flecourtier/phifem_stage}{github repository}
			\item a \href{https://csmi.cemosis.fr/csmi-stages-2023/m2/_attachments/Lecourtier-Fr\%C3\%A9d\%C3\%A9rique.pdf}{report} of the internship
			\item an \href{https://flecourtier.github.io/phifem_stage/phifem_project/1.0.3/main_page.html}{online report} generated with a tool called antora (made by a github CI)
		\end{enumerate}
	\end{frame}

	\begin{frame}{Problem considered}
		\textbf{Poisson problem with Dirichlet conditions :} \\
		Find $u : \Omega \rightarrow \mathbb{R}^d (d=1,2,3)$ such that
		\begin{equation}
			\left\{
			\begin{aligned}
				-\Delta u &= f, \; &&\text{in } \; \Omega, \\
				u&=g, \; &&\text{on } \; \partial\Omega,
			\end{aligned}
			\right. \tag{$\mathcal{P}$} \label{pb_initial}
		\end{equation}
		with $\Delta$ the Laplace operator, $\Omega$ a smooth bounded open set and $\partial\Omega$ its boundary. \\
		In this section, we defined by
		\begin{equation*}
			||u_{ex}-u_{method}||_{0,\Omega}^{(rel)}=\frac{\int_\Omega (u_{ex}-u_{method})^2}{\int_\Omega u_{ex}^2}
		\end{equation*}
		the relative error between the exact solution $u_{ex}$ and $u_{method}$ a solution obtained by FEM or $\phi$-FEM, a correction solver or the prediction of an neural network.
		
%		We can defined too
%		\begin{equation*}
%			||u_{ex}-u_{method}||_{0,\Omega_h}^{(abs)}=\int_{\Omega_h} (u_{ex}-u_{method})^2
%		\end{equation*}
%		the absolute error.
	\end{frame}

	\section{General methods and tools}
	
	\subsection{Standard FEM method}
	
	\begin{frame}{Presentation of standard FEM method}	
		\textbf{Variational Problem :} 
		\begin{equation*}
			\text{Find } u\in V \text{ such that } a(u,v)=l(v), \;\forall v\in V
		\end{equation*}
		where $V$ is a Hilbert space, $a$ is a bilinear form and $l$ is a linear form.
		
		\textbf{Approach Problem :} 
		\begin{equation*}
			\text{Find } u_h\in V_h \text{ such that } a(u_h,v_h)=l(v_h), \;\forall v_h\in V
		\end{equation*}
		with $u_h$ an approximate solution in $V_h$, a finite-dimensional space dependent on $h$ such that $\quad V_h\subset V, \; dimV_h = N_h<\infty, \; (\forall h>0)$ 
		
		As $u_h=\sum_{i=1}^{N_h}u_i\varphi_i$ with $(\varphi_1,\dots,\varphi_{N_h})$ a basis of $V_h$, finding an approximation of the PDE solution implies solving the following linear system:
		\begin{equation*}
			AU=b
		\end{equation*}
		with
		\begin{equation*}
			A=(a(\varphi_i,\varphi_j))_{1\le i,j\le N_h}, \quad U=(u_i)_{1\le i\le N_h} \quad \text{and} \quad b=(l(\varphi_j))_{1\le j\le N_h}
		\end{equation*}
	\end{frame}

	\begin{frame}{In practice}
		\begin{enumerate}[\ding{217}]
			\item \begin{minipage}[t]{0.68\linewidth}
				Construct a mesh of our $\Omega$ geometry with a family of elements (in 2D: triangle, rectangle; in 3D: tetrahedron, parallelepiped, prism) defined by
				$$\mathcal{T}_h = \left\{K_1,\dots,K_{N_e}\right\}$$
				where $N_e$ is the number of elements. \\
			\end{minipage} \begin{minipage}[t][][b]{0.28\linewidth}
				\centering
				\qquad \pgfimage[width=0.8\linewidth]{images/methods_tools/FEM_triangle_mesh.png}
			\end{minipage}
			(Importance of geometric quality)
			\item Construct a space of piece-wise affine continuous functions, defined by
			\begin{equation*}
				V_h:=P_{C,h}^k=\{v_h\in C^0(\bar{\Omega}), \forall K\in\mathcal{T}_h, {v_h}_{|K}\in\mathbb{P}_k\}
			\end{equation*}
			where $\mathbb{P}_k$ is the vector space of polynomials of total degree less than or equal to $k$.
		\end{enumerate}
		
	\end{frame}

	\subsection{$\phi$-FEM method}
	
	\begin{frame}{Problem}
		We pose $u=\phi w+g$ such that
		$$\left\{\begin{aligned}
			-\Delta u &= f, \; \text{on } \Omega, \\
			u&=g, \; \text{in } \Gamma, \\
		\end{aligned}\right.$$
		where $\phi$ is the level-set function and $\Omega$ and $\Gamma$ are given by :
		$$
		\Omega=\{\phi < 0\} \quad \text{and} \quad \Gamma=\{\phi = 0\}.$$
		\begin{center}
			\pgfimage[width=0.3\linewidth]{images/methods_tools/PhiFEM_level_set.png}
		\end{center}
		The level-set function $\phi$ is supposed to be known on $\mathbb{R}^d$ and sufficiently smooth. \\
		For instance, the signed distance to $\Gamma$ is a good candidate
	\end{frame}
	
	\begin{frame}{Fictitious domain}
		\setstretch{0.5}
		\begin{minipage}{0.39\linewidth}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/PhiFEM_domain.png} \\ \tiny \; \\
			\pgfimage[width=0.15\linewidth]{images/methods_tools/PhiFEM_fleche.png} \qquad \qquad \qquad \qquad  \\
			\tiny \pgfimage[width=\linewidth]{images/methods_tools/PhiFEM_domain_considered.png}
		\end{minipage}
		\begin{minipage}{0.6\linewidth}
			\begin{enumerate}[\ding{217}]
				\item $\mathcal{O}$ : fictitious domain such that $\Omega\subset\mathcal{O}$
				\item $\mathcal{T}_h^\mathcal{O}$ : simple quasi-uniform mesh on $\mathcal{O}$
				\item $\phi_h=I_{h,\mathcal{O}}^{(l)}(\phi)\in V_{h,\mathcal{O}}^{(l)}$ : approximation of $\phi$ \\ 
				with $I_{h,\mathcal{O}}^{(l)}$ the standard Lagrange interpolation operator on
				$$V_{h,\mathcal{O}}^{(l)}=\left\{v_h\in H^1(\mathcal{O}):v_{h|_T}\in\mathbb{P}_l(T) \;  \forall T\in\mathcal{T}_h^\mathcal{O}\right\}$$
				\item $\Gamma_h=\{\phi_h=0\}$ : approximate boundary of $\Gamma$
				\item $\mathcal{T}_h$ : sub-mesh of $\mathcal{T}_h^\mathcal{O}$ defined by
				$$\mathcal{T}_h=\left\{T\in \mathcal{T}_h^\mathcal{O}:T\cap\{\phi_h<0\}\ne\emptyset\right\}$$
				\item $\Omega_h$ : domain covered by the $\mathcal{T}_h$ mesh defined by
				$$\Omega_h=\left(\cup_{T\in\mathcal{T}_h}T\right)^O$$
				($\partial\Omega_h$ its boundary)
			\end{enumerate}			
		\end{minipage}
	\end{frame}
	
	\begin{frame}{Facets and Cells sets}
		\begin{minipage}{0.38\linewidth}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/PhiFEM_boundary_cells.png} \\ \; \\ \; \\
			\pgfimage[width=\linewidth]{images/methods_tools/PhiFEM_boundary_edges.png}
		\end{minipage} \;
		\begin{minipage}{0.6\linewidth}
			\begin{enumerate}[\ding{217}]
				\item $\mathcal{T}_h^\Gamma\subset \mathcal{T}_h$ : contains the mesh elements cut by $\Gamma_h$, i.e. 
				\begin{equation*}
					\mathcal{T}_h^\Gamma=\left\{T\in\mathcal{T}_h:T\cap\Gamma_h\ne\emptyset\right\},
				\end{equation*}
				\item $\Omega_h^\Gamma$ : domain covered by the $\mathcal{T}_h^\Gamma$ mesh, i.e.
				\begin{equation*}
					\Omega_h^\Gamma=\left(\cup_{T\in\mathcal{T}_h^\Gamma}T\right)^O
				\end{equation*}
				\item $\mathcal{F}_h^\Gamma$ : collects the interior facets of $\mathcal{T}_h$ either cut by $\Gamma_h$ or belonging to a cut mesh element, i.e.
				\begin{align*}
					\mathcal{F}_h^\Gamma=\left\{E\;(\text{an internal facet of } \mathcal{T}_h) \text{ such that }\right. \\
					\left. \exists T\in \mathcal{T}_h:T\cap\Gamma_h\ne\emptyset \text{ and } E\in\partial T\right\}
				\end{align*}
			\end{enumerate}
		\end{minipage}
	\end{frame}

	\begin{frame}{Direct Method - Poisson problem}
		\textbf{Approach Problem :} Find $w_h\in V_h^{(k)}$ such that 
		$$a_h(w_h,v_h) = l_h(v_h) \quad \forall v_h \in V_h^{(k)}$$
		where
		$$a_h(w,v)=\int_{\Omega_h} \nabla (\phi_h w) \cdot \nabla (\phi_h v) - \int_{\partial\Omega_h} \frac{\partial}{\partial n}(\phi_h w)\phi_h v+G_h(w,v),$$
		$$l_h(v)=\int_{\Omega_h} f \phi_h v + G_h^{rhs}(v)$$
		and 
		$$V_h^{(k)}=\left\{v_h\in H^1(\Omega_h):v_{h|_T}\in\mathbb{P}_k(T), \; \forall T\in\mathcal{T}_h\right\}.$$
		For the non homogeneous case, we replace
		$$u=\phi w \quad \rightarrow \quad u=\phi w+g$$ 
		by supposing that $g$ is currently given over the entire $\Omega_h$.
	\end{frame}

	\begin{frame}{Stabilization terms}
		\begin{center}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/PhiFEM_stab_terms.png}
		\end{center}
		\small
		\underline{1st term :} Ghost penality [Burman, 2010], ensure continuity of the solution by penalizing gradient jumps. \\
		\underline{2nd term :} require the solution to verify the strong form on $\Omega_h^\Gamma$. \\
		\normalsize
		\textbf{Purpose :} 
		\begin{enumerate}[\ding{217}]
			\item reduce the errors created by the "fictitious" boundary 
			\item ensure the correct condition number of the finite element matrix
			\item permit to restore the coercivity of the bilinear scheme
		\end{enumerate}
	\end{frame}
			
	\begin{frame}{Dual method -  Poisson Problem}
		\setstretch{0.5}		
		\textbf{Problem :} Find $u$ on $\Omega_h$ and $p$ on $\Omega_h^\Gamma$ such that
		\begin{align*}
			\int_{\Omega_h}\nabla u\nabla v&-\int_{\partial\Omega_h}\frac{\partial u}{\partial n} v + \frac{\gamma}{h^2} \sum_{T\in\mathcal{T}_h^\Gamma}\int_T \left(u-\frac{1}{h}\phi p\right)\left(v-\frac{1}{h}\phi q\right) \\
			&+ G_h(u,v) = \int_{\Omega_h}fv + G_h^{rhs}(v), \; \forall v \; \text{on } \Omega_h, \; q \; \text{on } \Omega_h^\Gamma
		\end{align*}
		with $\gamma$ an other positive stabilization parameter and $G_h$ and $G_h^{rhs}$ the stabilization terms defined previously.
		
		For the non homogeneous case, we replace
		$$\int_T \left(u-\frac{1}{h}\phi p\right)\left(v-\frac{1}{h}\phi q\right) \quad \rightarrow \quad \int_T\left(u-\frac{1}{h}\phi p-g\right)\left(v-\frac{1}{h}\phi q\right)$$ 
		by assuming $g$ is defined on $\Omega_h^\Gamma$
	\end{frame}

	\subsection{Fourier Neural Operator (FNO)}

	\begin{frame}{Architecture of the FNO}
		\begin{center}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/FNO_schema.png}
		\end{center}
		\textbf{Input $X$} of shape (bs,ni,nj,nk) \qquad \qquad \textbf{Output $Y$} of shape (bs,ni,nj,1) \\
		with bs the batch size, ni and nj the grid resolution and nk the number of channels.
	\end{frame}

	\begin{frame}{Important points}
		\begin{enumerate}[\ding{217}]
			\item widely used in PDE solving and constitute an active field of research
			\item FNO are Neural Operator networks : Unlike standard neural networks, which learn using inputs and outputs of fixed dimensions, neural operators \textbf{learn operators, which are mappings between spaces of functions}.
			\item \textbf{Mesh resolution independent :} can be evaluated at any data resolution without the need for retraining
		\end{enumerate}
	\end{frame}

	\begin{frame}{Objective}
		FNO Training :
		\begin{center}
			\pgfimage[width=\linewidth]{images/methods_tools/FNO_train_schema.png}
		\end{center}
		Correction on the FNO predictions :
		\begin{center}
			\pgfimage[width=\linewidth]{images/methods_tools/FNO_test_schema.png}
		\end{center}
	\end{frame}
	
	\section{Correction}
	
	\subsection{Problems considered}
	
	\begin{frame}{Trigonometric solution on a Square}
		\setstretch{0.7}
		\begin{minipage}{0.3\linewidth}
			\centering
			\pgfimage[width=0.8\linewidth]{images/corr/geom_square.png}
		\end{minipage} \;
		\begin{minipage}{0.68\linewidth}
			\begin{enumerate}[\ding{217}]
				\item Level-set function : 
				$$\phi(x,y)=x(1-x)y(1-y)$$
				\item Analytical solution : (Homogeneous if $\varphi=0$)
				$$u_{ex}(x,y)=S\times sin\left(2\pi fx+\varphi\right)\times sin\left(2\pi fy+\varphi\right)$$				
			\end{enumerate}
		\end{minipage}
		
		\begin{enumerate}[\ding{217}]
			\item Source term : $$f(x,y)=8\pi^2 Sf^2sin\left(2\pi fx + \varphi\right)sin\left(2\pi fy + \varphi\right)$$
			
			\begin{minipage}{0.48\linewidth}
				\begin{itemize}
					\item $S=0.5\in[0,1]$ : amplitude of the signal 
					\item $f\in\mathbb{N}$ : "frequency" of the signal
					\item $\varphi\in[0,1]$ : phase at the origin
				\end{itemize}
			\end{minipage} \;
			\begin{minipage}{0.48\linewidth}
				\centering
				\pgfimage[width=\linewidth]{images/corr/norms.png}
			\end{minipage}
		\end{enumerate}
	\end{frame}

	\begin{frame}{Unknown solution on a Circle}
		\setstretch{0.7}
		\begin{minipage}{0.3\linewidth}
			\centering
			\pgfimage[width=0.8\linewidth]{images/corr/geom_circle.png}
		\end{minipage} \;
		\begin{minipage}{0.68\linewidth}
			\begin{enumerate}[\ding{217}]
				\item Level-set function : 
				$$\phi(x,y)=-1/8+(x-1/2)^2+(y-1/2)^2$$
			\end{enumerate}
		\end{minipage}
		\begin{enumerate}[\ding{217}]
			\item Source term : 
			$$f(x,y) = exp\left(-\frac{(x-\mu_0)^2 + (y-\mu_1)^2}{2\sigma^2}\right)$$
			\begin{itemize}
				\item $\sigma \sim \mathcal{U}([0.1,0.6])$
				\item $\mu_0, \mu_1 \sim \mathcal{U}([0.5-\sqrt{2}/4, 0.5+\sqrt{2}/4])$ 
			\end{itemize}
			with the condition $\phi(\mu_0, \mu_1) < -0.05$
			\item a reference solution $u_{ref}$ : over-refined $\mathbb{P}^1$ solution obtained with FEM
		\end{enumerate}
	\end{frame}
	
	\subsection{Methods considered}
	
	\begin{frame}{Correction by adding}
		We are given $\tilde{\phi}$ an "initial" solution to the problem under consideration.
		
		We will consider
		\begin{equation*}
			\tilde{u}=\tilde{\phi}+\tilde{C}
		\end{equation*}
	
		We want to find $\tilde{C}: \Omega \rightarrow \mathbb{R}^d$ solution to the problem
		\begin{equation*}
			\left\{\begin{aligned}
				-\Delta \tilde{u}&=f, \; &&\text{on } \Omega, \\
				\tilde{u}&=g, \; &&\text{in } \Gamma.
			\end{aligned}\right.
		\end{equation*}
		with $\tilde{C}=\phi C$ for the $\phi$-FEM method.
		
		Rewriting the problem, we seek to find $\tilde{C}: \Omega \rightarrow \mathbb{R}^d$ solution to the problem
		\begin{equation}
			\left\{\begin{aligned}
				-\Delta \tilde{C}&=\tilde{f}, \; &&\text{on } \Omega, \\
				\tilde{C}&=0, \; &&\text{in } \Gamma.
			\end{aligned}\right. \tag{$\mathcal{C}_{+}$} \label{corr_add}
		\end{equation}
		with $\tilde{f}=f+\Delta\tilde{\phi}$.

		In practice, it may be useful to integrate by parts the term containing $\Delta \tilde{\phi}$.
	\end{frame}

	\begin{frame}{Correction by multiplying}
		We will considering 
		\begin{equation*}
			\tilde{u}=\tilde{\phi}C
		\end{equation*}
		
		We want to find $C: \Omega \rightarrow \mathbb{R}^d$ solution to the problem
		\begin{equation*}
			\left\{\begin{aligned}
				&-\Delta (\tilde{\phi}C)=f, \; &&\text{on } \Omega, \\
				&C=1, \; &&\text{on } \; \Gamma.
			\end{aligned}\right. \tag{$\mathcal{C}_\times$} \label{corr_mult}
		\end{equation*}
		
		In the non-homogeneous case, it is important to impose the boundary conditions either by the direct method or by the dual method.
	\end{frame}

	\begin{frame}{Correction by multiplying (elevated problem)}
		We introduced an initial modified problem : Find $\hat{u} : \Omega \rightarrow \mathbb{R}^d$ such that
		\begin{equation}
			\left\{
			\begin{aligned}
				-\Delta \hat{u} = f, \; &&\text{in } \; \Omega, \\
				\hat{u}=g+m, \; &&\text{on } \; \Gamma,
			\end{aligned}
			\right. \tag{$\mathcal{P}^\mathcal{M}$} \label{pb_reh}
		\end{equation}
		with $\hat{u}=u+m$ and $m$ a constant.
		
		We then apply the multiplication correction on the elevated problem by considering
		\begin{equation*}
			\hat{\phi}=\tilde{\phi}+m
		\end{equation*}
		and so we look for $C: \Omega \rightarrow \mathbb{R}^d$ solution to the problem
		\begin{equation*}
			\left\{\begin{aligned}
				&-\Delta (\hat{\phi}C)=f, \; &&\text{in } \; \Omega, \\
				&C=1, \; &&\text{on } \; \Gamma.
			\end{aligned}\right. \tag{$\mathcal{C}_\times^\mathcal{M}$} \label{corr_mult_reh}
		\end{equation*}
		
		In the case of this correction, it is important to impose the boundary conditions either by the direct method, or by the dual method.
	\end{frame}
	
	\begin{frame}{Theoretical results}
		We consider $\hat{u_{ex}}=u_{ex}+m$ the exact solution of the elevated problem (\ref{pb_reh}) with $u_{ex}$ the exact solution of the initial problem (\ref{pb_initial}). \\
		Here, we are interested by (\ref{corr_mult_reh}) with standard FEM on a disturbed solution defined by
		$$\hat{\phi}=\tilde{\phi}+m=\hat{u_{ex}}+\epsilon P$$
		with $\tilde{\phi}=u_{ex}+\epsilon P$.
		\begin{enumerate}[\ding{217}]
			\item We have $\quad \left|\left|\hat{u_{ex}}-\hat{u_h}\right|\right|_0\le ch^{k+1}||\hat{\phi}||_\infty\left|C\right|_{k+1}$
			\item With $m$ sufficiently large, the error no longer depends on the solution but only on the perturbation $P$ :
			\begin{equation*}
				\left|\left|\frac{\hat{u_{ex}}}{\hat{\phi}}-C_h\right|\right|_{0,\Omega}\le ch^{k+1}\epsilon\left|\left|P''\right|\right|_{0,\Omega}
			\end{equation*}
			\item When m tends to infinity, the solution obtained with multiplication correction on an elevated problem  (\ref{corr_mult_reh}) converges to the solution obtained with correction by adding (\ref{corr_add}).
		\end{enumerate}
	\end{frame}
	
	\subsection{Numerical results}
	
	\begin{frame}{Correction on exact solution}
		We consider the trigonometric solution on the square ($n_{vert}=100$) and
		$$\tilde{\phi}=u_{ex}\in\mathbb{P}_{10}$$
		\textbf{Results with FEM :}
		\begin{center}
			\pgfimage[width=0.6\linewidth]{images/corr/corr_ana/tab_errors_fem.png}
		\end{center}
		\textbf{Results with $\phi$-FEM :}
		\begin{center}
			\pgfimage[width=0.6\linewidth]{images/corr/corr_ana/tab_errors_phifem.png}
		\end{center}
		\textbf{Remark :} For the addition, we hope $C=0$ and for the multiplication $C=1$ (on $\Omega$).
	\end{frame}

	\begin{frame}[allowframebreaks]{Correction on disturbed solution}
		We consider the trigonometric solution on the square ($n_{vert}=100$ and $\varphi=0$) and
		$$\tilde{\phi}=u_{ex}+\epsilon P\in\mathbb{P}_{10}$$
		
		where $\epsilon$ a real number and $P$ the perturbation (same expression as $u_{ex}$ with $(S_p,f_p,\varphi_p)$ parameters). Consider $\varphi_p=0$ so that $P=0$ on $\Gamma$ and therefore $\tilde{\phi}=0$ on $\Gamma$.
		
		\textbf{1st result :} $\epsilon$ convergence. \\
		Correction by adding with FEM :
		\begin{center}
			\pgfimage[width=0.27\linewidth]{images/corr/corr_pert/epsilon_convergence.png}
		\end{center}
	
		\textbf{2nd result :} Importance of perturbation form.
		
		We fix $f_p=2$ and $\epsilon=0.001$. \\
		Correction by multiplying on an elevated problem with FEM :
		\begin{minipage}{0.58\linewidth}
			\centering
			\pgfimage[width=0.9\linewidth]{images/corr/corr_pert/pert_tab.png}
		\end{minipage} \;
		\begin{minipage}{0.38\linewidth}
			\centering
			\pgfimage[width=\linewidth]{images/corr/corr_pert/pert_fig.png}
		\end{minipage}
	
		\newpage
	
		\textbf{3rd result :} Convergence of the correction by multiplying on an elevated problem. \\
		Correction by multiplying on the elevated problem with FEM and $\phi$-FEM :
		\begin{center}
			\pgfimage[width=\linewidth]{images/corr/corr_pert/rehaussement/fig_reh.png}
		\end{center}
	
		\textbf{Remark :} For $\phi$-FEM, we do not find the same type of results.
	\end{frame}

	\begin{frame}[allowframebreaks]{Correction on a FNO prediction}
		We consider the unknown solution on the circle (with $f$ Gaussian) and
		$$\tilde{\phi}=u_{FNO}\in\mathbb{P}_{2}$$
		where $u_{FNO}$ is the FNO prediction ($n_{vert}=32$). 
		
		\begin{minipage}{0.48\linewidth}
			Training on 4000 epochs (bs=64,lr=0.01) :
			\centering
			\pgfimage[width=0.9\linewidth]{images/corr/corr_FNO/misfits_f_gaussienne.png}
		\end{minipage}
		\begin{minipage}{0.48\linewidth}
			Test sample ($n_{test}=100$, $n_{vert}=32$) :
			\centering
			\pgfimage[width=0.7\linewidth]{images/corr/corr_FNO/infos_test_f_gaussienne.png}
		\end{minipage}	
		
		\newpage
		
		We will apply the different correction methods on the FNO prediction on the test sample. \\
		\begin{minipage}{0.58\linewidth}
			\centering
			\pgfimage[width=\linewidth]{images/corr/corr_FNO/corr_boxplot.png}
		\end{minipage} \;
		\begin{minipage}{0.38\linewidth}
			\centering
			\pgfimage[width=\linewidth]{images/corr/corr_FNO/corr_errors.png}
		\end{minipage}
	
		\textbf{Remark :} We should try to reduce the resolution for correction, maybe we will gain in the time-to-error ratio.
	\end{frame}

	\begin{frame}[allowframebreaks]{Correction with other networks}
		\textbf{Idea :} using a neural network to predict a single solution at any point in the domain \\
		\quad input data = a collection of $n_{pts}$ 2D points : $\{(x_i,y_i)\}_{i=1,\dots, n_{pts}}$ \\
		\quad output = solution at each of these points : $\{u_i\}_{i=1,\dots,n_{dots}}$ \\
		\quad \quad with $u_i=\phi(x_i,y_i)w_i$ and $w_i=w_\theta(x_i,y_i)$. \\ \; \\
		
		We try with a Physics-Informed Neural Networks (PINNs).
		
		\begin{minipage}{0.48\linewidth}
			model = MLP with 6-layer network ($\{10,20,60,60,20,10\}$)
			\centering
			\pgfimage[width=0.7\linewidth]{images/corr/corr_networks/MLP_schema.png}
			$$loss = mse(\Delta (\phi(x_i,y_i)w_{\theta,i})+f_i)$$
		\end{minipage}
		\begin{minipage}{0.48\linewidth}
			Training over 20000 epochs ($n_{test}=20000$) :
			\centering
			\pgfimage[width=\linewidth]{images/corr/corr_networks/PINNs_loss.png}
		\end{minipage}
		
		\newpage
		
		We consider the trigonometric solution on the square and $\tilde{\phi}=u_{PINNs}\in\mathbb{P}_{10}$ where $u_{PINNs}$ is the PINNs prediction ($n_{vert}=32$) and we have 
		\begin{equation*}
			||u_{ex}-\tilde{\phi}||_{0,\Omega}^{(rel)}=1.93e-3.
		\end{equation*}
		We will correct this solution with the correction by adding (with FEM and $\phi$-FEM).
		
		\begin{minipage}{0.48\linewidth}
			Standard FEM method :
			\centering
			\pgfimage[width=0.6\linewidth]{images/corr/corr_networks/PINNs_FEM_add.png} \\
			$||u_{ex}-\tilde{\phi}C||_{0,\Omega}^{(rel)}=1.13e-4$ \\
			divided by 246.60 (FEM : 2.80e-2)
		\end{minipage}
		\begin{minipage}{0.48\linewidth}
			$\phi$-FEM method :
			\centering
			\pgfimage[width=0.6\linewidth]{images/corr/corr_networks/PINNs_FEM_add.png} \\
			$||u_{ex}-\tilde{\phi}C||_{0,\Omega}^{(rel)}=1.27e-4$ \\
			divided by 151.34 ($\phi$-FEM : 1.92e-2)
		\end{minipage}
		
	\end{frame}
	
	\section{Conclusion} %perspectives
	
	\begin{frame}{Conclusion}
		\begin{enumerate}[\ding{217}]
			\item obtain numerical results on analytical solutions $\Rightarrow$ correction methods considered functional and theoretical results confirmed
			\item correction methods on the FNO predictions not satisfactory
			\item try to increase the degree of the solution : 
			\begin{itemize}
				\item Legendre and MLP not satisfactory 
				\item PINNs : reduction of the error made by conventional methods (FEM and $\phi$-FEM) by a factor of around 100 (correction by addition). 
			\end{itemize}
		\end{enumerate}
		\textbf{Perspectives :}
		\begin{enumerate}[\ding{217}]
			\item try adding PINNs to the output of the FNO (add the PINNs as a layer output that would replace the decomposition into a series of polynomials) $\Rightarrow$ solution at any point in the domain 
			\item carry out some documentation work to find more suitable models than the FNO
			\item consider more complex and time-varying geometries (such as 3D organ geometries)
		\end{enumerate}
	\end{frame}

	\section{Bibliography}
	
	\begin{frame}[allowframebreaks]{}
		\tiny
		\setstretch{0.2}
		\AtNextBibliography{\tiny}
		\printbibliography[heading=none]
	\end{frame}

	\begin{frame}{Description of the FNO architecture}
		\begin{center}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/FNO_schema_moitie1.png}
		\end{center}
		\begin{enumerate}[\ding{217}]
			\item perform a $P$ transformation, to move to a space with more channels (to build a sufficiently rich representation of the data)
			\item apply $L$ Fourier layers defined by
			$$\mathcal{H}_\theta^l(\tilde{X})=\sigma\left(\mathcal{C}_\theta^l(\tilde{X})+\mathcal{B}_\theta^l(\tilde{X})\right),\; l=1,\dots,L$$
			with $\tilde{X}$ the input of the current layer and
			\begin{itemize}
				\item $\sigma$ an activation function (ReLU or GELU)
				\item $\mathcal{C}_\theta^l$ : convolution sublayer (convolution performed by Fast Fourier Transform)
				\item $\mathcal{B}_\theta^l$ : "bias-sublayer"
			\end{itemize}
			\item return to the target dimension by performing a $Q$ transformation (in our case, the number of output channels is 1)
		\end{enumerate}
	\end{frame}

	\begin{frame}{Fourier Layer Structure}
		\setstretch{0.5}
		\textbf{Convolution sublayer : } \quad $\mathcal{C}_\theta^l(X)=\mathcal{F}^{-1}(\mathcal{F}(X)\cdot\hat{W})$ \quad
		\begin{minipage}{0.3\linewidth}
			\vspace{-15pt}
			\centering
			\pgfimage[width=\linewidth]{images/methods_tools/FNO_schema_moitie2.png}
		\end{minipage}
		\begin{enumerate}[\ding{217}]
			\item $\hat{W}$ : a trainable kernel
			\item $\mathcal{F}$ : 2D Discrete Fourier Transform (DFT) defined by
			\begin{equation*}
				\mathcal{F}(X)_{ijk}=\frac{1}{ni}\frac{1}{nj}\sum_{i'=0}^{ni-1}\sum_{j'=0}^{nj-1}X_{i'j'k}e^{-2\sqrt{-1}\pi\left(\frac{ii'}{ni}+\frac{jj'}{nj}\right)}
			\end{equation*}
			$\mathcal{F}^{-1}$ : its inverse.
			\item $(Y\cdot\hat{W})_{ijk}=\sum_{k'}Y_{ijk'}\hat{W}_{ijk'} \quad \Rightarrow \quad$ applied channel by channel
		\end{enumerate} \; \\
		\textbf{Bias-sublayer :} \quad  $\mathcal{B}_\theta^l(X)_{ijk}=\sum_{k'}X_{ijk}W_{k'k}+B_k$ \quad
		\begin{minipage}{0.3\linewidth}
			\vspace{-10pt}
			\pgfimage[width=0.3\linewidth]{images/methods_tools/FNO_schema_moitie2_bis.png}
		\end{minipage}
		\begin{enumerate}[\ding{217}]
			\item 2D convolution with a kernel of size 1
			\item allowing channels to be mixed via a kernel without allowing interaction between pixels.
		\end{enumerate}
	\end{frame}

	\begin{frame}{Correction on a $\phi$-FEM solution}
		We consider the trigonometric solution on the square and
		$$\tilde{\phi}=u_{\phi-FEM}\in\mathbb{P}_{2}$$
		where $u_{\phi-FEM}$ is the solution obtained with $\phi$-FEM ($n_{vert}=32$). \\
		We will correct this solution with the different correction methods by using FEM. \\
		We obtain the following correction terms ($\tilde{C}$ for addition and $C$ for multiplication) :
		\begin{center}
			\pgfimage[width=0.9\linewidth]{images/corr/corr_phifem/results_corr.png}
		\end{center}
	\end{frame}
	
	\begin{frame}{Correction on a $\phi$-FEM solution - Derivatives}
		We compute the first and second derivatives of $\tilde{\phi}$ according to $x$ and $y$.
		\begin{center}
			\pgfimage[width=\linewidth]{images/corr/corr_phifem/derivees.png}
		\end{center}
		We can see that the second derivatives are quite far from the true derivatives.
	\end{frame}
	
\end{document}
