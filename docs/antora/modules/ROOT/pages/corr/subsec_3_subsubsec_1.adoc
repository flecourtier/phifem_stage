:stem: latexmath
:xrefstyle: short
= Correction on disturbed solution

Now, let's consider a deliberately disturbed solution. The purpose of this step is to check that the correction solvers also work with a solution that is very close to the real solution, but not exact. In this section, we will consider a manually disturbed solution, i.e. the exact solution to which we've added a small, analytically known perturbation.

As explained above, we begin by considering stem:[\tilde{\phi}] as a manually perturbed solution defined by
[stem]
++++
\tilde{\phi}(x,y)=u_{ex}(x,y)+\epsilon P(x,y)
++++
where stem:[u_{ex}] defines the exact solution to the problem, stem:[P] the perturbation applied to it and stem:[\epsilon] is a real number that allows the amplitude of the perturbation to be easily increased or decreased. 

In this section, we'll assume that stem:[\tilde{\phi}] is in stem:[\mathbb{P}_k] with stem:[k=10].


[NOTE]
====
Notice that by taking stem:[\epsilon=0], we return to the case of correction on an exact solution presented in xref:corr/subsec_3_subsubsec_0.adoc[Section "Correction on exact solution"]. 
====

In our case, we will choose to consider stem:[P] as being of the same form as our exact solution (defined with different parameters), but we could very well consider a completely different perturbation. 


[NOTE]
====
Note that the form of the perturbation has a huge influence on the accuracy of the solvers, and that the difficulty lies in the following cases where its expression is not explicitly known (as in the case of stem:[\phi]-FEM in xref:corr/subsec_3_subsubsec_2.adoc[Section "Correction on stem:[\phi]-FEM solution"] or FNO in xref:corr/subsec_3_subsubsec_3.adoc[Section "Correction with FNO"]).
====

In the case of Circle geometry where we consider the problem \ref{Corr.pb.circle.1}, the perturbation will be defined by
[stem]
++++
P(x,y)=S_p\times\sin\left(8\pi f_p\left((x-0.5)^2+(y-0.5)^2\right)+\varphi_p\right)
++++
where stem:[S_p\in[0,1]] is the amplitude of the signal, stem:[f_p\in\mathbb{N}] can be associated with the "frequency" of the signal and stem:[\varphi_p\in[0,1]] the phase at the origin.

In the case of Square geometry where we consider the problem \ref{Corr.pb.square.1}, the perturbation will be defined by
[stem]
++++
P(x,y)=S_p\times\sin\left(2\pi f_px+\varphi_p\right)\times\sin\left(2\pi f_py+\varphi_p\right)
++++
where stem:[S_p\in[0,1]] is the amplitude of the signal, stem:[f_p\in\mathbb{N}] can be associated with the "frequency" of the signal and stem:[\varphi_p\in[0,1]] the phase at the origin.


[NOTE]
====
Note that for the boundary conditions of the solution to be satisfied, i.e. for stem:[\tilde{\phi}=u_{ex}] on stem:[\Gamma], it is essential that stem:[P=0] on stem:[\Gamma]. In the case of both circle and square, we will then take stem:[\varphi_p=0].
====

Recall the relative errors obtained by standard FEM and stem:[\phi]-FEM on the circle and on the square for frequencies stem:[f\in\{1,2,3,4\}] for the homogeneous  (<<norms>>) and non-homogeneous problem  (<<norms_nh>>).

[cols="a,a"]
|===
|[[norms]]
.figure
image::corr/corr_pert/diff_eps/norms.png[width=240.0,height=192.0]
|[[norms_nh]]
.figure
image::corr/corr_pert/diff_eps/norms_nh.png[width=240.0,height=192.0]

|===


[NOTE]
====
In the previous results, we use the direct method to impose the boundary conditions with stem:[\phi]-FEM.
====

== Results with differents stem:[\epsilon]

The aim of this section is to test correction by addition (without IPP) and correction by multiplication by varying the amplitude of the perturbation (in other words, by varying stem:[\epsilon]). 

We will try to separate the cases according to the frequencies considered. In other words, for stem:[f,f_p\in\{1,2,3,4\}], we're interested in the following three cases. The first is the case where the solution frequency is greater than the perturbation frequency (stem:[f>f_p]), i.e. a highly variable solution and a less variable perturbation. The second is where the solution and perturbation frequencies are equal (stem:[f=f_p]), i.e. the solution and perturbation have the same variability. The last category covers cases where the perturbation is "nastier" than the solution, i.e. it has a higher frequency than the solution (stem:[f<f_p]). 

In this section, we will consider for the circle the solution defined in <<_first_problem>> and for the square the solution defined in <<_problem>>.

*Results with standard FEM :*

First we will consider the standard FEM method on the homogeneous case (i.e. with stem:[\varphi=0]) and then on the non-homogeneous case (i.e. with stem:[\varphi=1]).


*  *Results on the homogeneous case :*

First, we consider the correction by adding (without IPP) on the Circle problem (<<corr_pert_fem_circle_add>>) and on the Square problem (<<corr_pert_fem_square_add>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_add]]
.figure
image::corr/corr_pert/diff_eps/fem_circle_add.png[width=285.0,height=228.0]
|[[corr_pert_fem_square_add]]
.figure
image::corr/corr_pert/diff_eps/fem_square_add.png[width=285.0,height=228.0]

|===

Then, we consider the correction by multiplying on the Circle problem (<<corr_pert_fem_circle_mult>>) and on the Square problem (<<corr_pert_fem_square_mult>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_mult]]
.figure
image::corr/corr_pert/diff_eps/fem_circle_mult.png[width=285.0,height=228.0]
|[[corr_pert_fem_square_mult]]
.figure
image::corr/corr_pert/diff_eps/fem_square_mult.png[width=285.0,height=228.0]

|===

*_Observation :_* We can make a few comments on the results obtained:

*   First of all, it would therefore seem that, overall, the smaller the perturbation applied (i.e. the smaller the stem:[\epsilon]), the more efficient the addition and multiplication correction solvers are in terms of accuracy.
*  Then, it would appear that, as with the standard FEM and stem:[\phi]-FEM solvers without correction, the more the solution varies (i.e. the larger stem:[f]), the greater the error. This is a fairly intuitive result, since the more the solution varies, the more points are needed to approximate it.
*  It would also seem that for stem:[\epsilon=1] (i.e. a large perturbation), the stem:[\epsilon] parameter has a greater impact on the multiplicative corrector than on the additive corrector. We explained earlier the benefits of elevating the problem, which could be beneficial here. Results on elevation will be presented in the <<_results_on_the_elevated_problem>>.
*  In view of the results obtained here, it would also appear that, overall, correction by addition is more effective than correction by multiplication. Moreover, correction by addition has more advantages than correction by multiplication. In particular, if the solution cancels out on the domain, correction by multiplication will require elevating the problem sufficiently so that it no longer cancels out, unlike correction by addition.
*  There is one final and rather important point to make. In fact, if we take a closer look at the results, we can see that in the case of correction by adding, the errors only seem to depend on the frequency of the perturbation and not on that of the solution (at a fixed stem:[\epsilon]). This is a result that has been explained theoretically in the case of correction by multiplication on a elevated problem in the xref:corr/subsec_2_subsubsec_0.adoc[Section "Interest of elevating the problem"] (for stem:[m] large, similar to correction by addition as explained above). Thus, as we have shown (in xref:corr/subsec_2_subsubsec_1.adoc[Section "Comparison of correction methods"]) that for stem:[m] large, the error of correction by multiplication on a elevated problem converges to the error of correction by addition, we recover this result on correction by addition.


*  *Results on the non-homogeneous case :*

First, we consider the correction by adding (without IPP) on the Circle problem (<<corr_pert_fem_circle_add_nh>>) and on the Square problem (<<corr_pert_fem_square_add_nh>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_add_nh]]
.figure
image::corr/corr_pert/diff_eps/fem_circle_add_nh.png[width=270.0,height=216.0]
|[[corr_pert_fem_square_add_nh]]
.figure
image::corr/corr_pert/diff_eps/fem_square_add_nh.png[width=270.0,height=216.0]

|===

Then, we consider the correction by multiplying on the Circle problem (<<corr_pert_fem_circle_mult_nh>>) and on the Square problem (<<corr_pert_fem_square_mult_nh>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_mult_nh]]
.figure
image::corr/corr_pert/diff_eps/fem_circle_mult_nh.png[width=285.0,height=228.0]
|[[corr_pert_fem_square_mult_nh]]
.figure
image::corr/corr_pert/diff_eps/fem_square_mult_nh.png[width=285.0,height=228.0]

|===

*_Observation :_* In view of the results obtained, it would appear that the conclusions are the same as for the homogeneous case.



[NOTE]
====
En considérant stem:[\tilde{\phi}] dans stem:[\mathbb{P}_2] et le problème homogène, on va appliquer la correction by adding on the Circle problem (<<corr_pert_fem_circle_add_P2>>) and on the Square problem (<<corr_pert_fem_square_add_P2>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_add_P2]]
.Correction by adding on the Circle with standard FEM in the homogeneous case (stem:[\tilde{\phi}] in stem:[\mathbb{P}_2]).

image::corr/corr_pert/diff_eps/fem_circle_add_P2.png[width=285.0,height=228.0]
|[[corr_pert_fem_square_add_P2]]
.Correction by adding on the Square with standard FEM in the homogeneous case (stem:[\tilde{\phi}] in stem:[\mathbb{P}_2]).

image::corr/corr_pert/diff_eps/fem_square_add_P2.png[width=285.0,height=228.0]

|===

And by considering the correction by multiplying on the Circle problem (<<corr_pert_fem_circle_mult_P2>>) and on the Square problem (<<corr_pert_fem_square_mult_P2>>).

[cols="a,a"]
|===
|[[corr_pert_fem_circle_mult_P2]]
.Correction by multiplying on the Circle with standard FEM in the homogeneous case (stem:[\tilde{\phi}] in stem:[\mathbb{P}_2]).

image::corr/corr_pert/diff_eps/fem_circle_mult_P2.png[width=285.0,height=228.0]
|[[corr_pert_fem_square_mult_P2]]
.Correction by multiplying on the Square with standard FEM in the homogeneous case (stem:[\tilde{\phi}] in stem:[\mathbb{P}_2]).

image::corr/corr_pert/diff_eps/fem_square_mult_P2.png[width=285.0,height=228.0]

|===
*_Observation :_* In view of the results obtained here, it seems that considering stem:[\phi] only in a space of degree 2 is not sufficient to considerably improve the errors obtained by standard methods, even when considering an exact solution.
====

*Results with stem:[\phi]-FEM :*

Then we will consider the stem:[\phi]-FEM method on the homogeneous case (i.e. with stem:[\varphi=0]) and then on the non-homogeneous case (i.e. with stem:[\varphi=1]).


*  *Results on the homogeneous case :*

First, we consider the correction by adding (without IPP) on the Circle problem (<<corr_pert_phifem_circle_add>>) and on the Square problem (<<corr_pert_phifem_square_add>>).

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_add]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_add.png[width=285.0,height=228.0]
|[[corr_pert_phifem_square_add]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_add.png[width=285.0,height=228.0]

|===

Then, we consider the correction by multiplying on the Circle problem (<<corr_pert_phifem_circle_mult>>) and on the Square problem (<<corr_pert_phifem_square_mult>>).

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_mult]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_mult.png[width=270.0,height=216.0]
|[[corr_pert_phifem_square_mult]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_mult.png[width=270.0,height=216.0]

|===

*_Observation :_* An interesting result can also be observed. Indeed, it seems that in the case where stem:[f=f_p], the multiplication correction with stem:[\phi]-FEM seems to approach the solution almost perfectly for all stem:[\epsilon] considered.
In fact, in the homogeneous case, for stem:[f=f_p] the perturbation is identical to the solution (i.e. stem:[P=u_{ex}]) and so the solution injected into the correction solvers is of the form
[stem]
++++
\tilde{\phi}=u_{ex}+\epsilon P=(1+\epsilon)u_{ex}
++++
In the case of correction by multiplication, we have stem:[\tilde{u}=\tilde{\phi}C]. So for stem:[\tilde{u}=u_{ex}], we must have
[stem]
++++
\tilde{\phi}C=u_{ex} \quad \iff \quad (1+\epsilon)u_{ex}C=u_{ex}
++++
So if the solution does not cancel out on stem:[\Omega], we must have
[stem]
++++
C=\frac{1}{1+\epsilon} \quad \text{on } \Omega
++++
By imposing stem:[C=\frac{1}{1+\epsilon}] on stem:[\Gamma] for FEM instead of stem:[C=1], we should get closer to the stem:[\phi]-FEM results obtained. We can see in <<norms_circle_f_eq_fp>> and <<norms_square_f_eq_fp>> that we obtain the expected results for FEM by changing the boundary condition stem:[C=1] to stem:[C=\frac{1}{1+\epsilon}].

[cols="a,a"]
|===
|[[norms_circle_f_eq_fp]]
.figure
image::corr/corr_pert/diff_eps/norms_circle_f_eq_fp.png[width=240.0,height=192.0]
|[[norms_square_f_eq_fp]]
.figure
image::corr/corr_pert/diff_eps/norms_square_f_eq_fp.png[width=240.0,height=192.0]

|===


[NOTE]
====
It should be noted, however, that in practice, for example in the case where stem:[\tilde{\phi}] is a stem:[\phi]-FEM solution or an FNO output, this case is not very realistic. There's no reason to expect the form of the perturbation created by the stem:[\phi]-FEM solver or by the FNO to be exactly identical to the solution under consideration.
====

*  *Results on the non-homogeneous case :*

First, we consider the correction by adding (without IPP) on the Circle problem (<<corr_pert_phifem_circle_add_nh>>) and on the Square problem (<<corr_pert_phifem_square_add_nh>>).

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_add_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_add_nh.png[width=270.0,height=216.0]
|[[corr_pert_phifem_square_add_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_add_nh.png[width=270.0,height=216.0]

|===

Then, we consider the correction by multiplying on the Circle problem (<<corr_pert_phifem_circle_mult_nh>>) and on the Square problem (<<corr_pert_phifem_square_mult_nh>>). We start by considering the same stem:[\phi]-FEM scheme as in the homogeneous case, i.e. here we don't impose any boundary conditions.

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_mult_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_mult_nh.png[width=240.0,height=192.0]
|[[corr_pert_phifem_square_mult_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_mult_nh.png[width=240.0,height=192.0]

|===

*_Observation :_* We note that the multiplicative corrector using stem:[\phi]-FEM seems to succeed, in a similar way to the homogeneous case, to correct the non-homogeneous problem without imposing the boundary conditions. In fact, there's a subtlety to the scheme we're considering here. Unlike stem:[\phi]-FEM (without correction), the scheme is written on stem:[\tilde{\phi}], which is non-zero at the boundary, and not on stem:[\phi], which is zero at the boundary. This could explain this result, whereas in the case of stem:[\phi]-FEM (without correction), we can't avoid imposing boundary conditions.

We will now use the direct method to impose the boundary condition. For this method, we're tempted to consider the solution stem:[\tilde{u}=\tilde{\phi}C+g] as the solution to the multiplication correction problem. In fact, unlike the classic stem:[\phi]-FEM method, the stem:[\tilde{\phi}] function that replaces our level-set in the formulation is non-zero at the boundary and so, by imposing stem:[C=1] at the boundary, we'd have stem:[\tilde{u}=2g]. To avoid this problem, we will raise the problem by stem:[-g] and consider stem:[\tilde{u}=(\tilde{\phi}-g)C+g]. We will test this method on the circle (<<corr_pert_phifem_circle_mult_direct_nh>>) and on the square (<<corr_pert_phifem_square_mult_direct_nh>>).

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_mult_direct_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_mult_direct_nh.png[width=240.0,height=192.0]
|[[corr_pert_phifem_square_mult_direct_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_mult_direct_nh.png[width=240.0,height=192.0]

|===

We're now going to test imposing boundary conditions with the dual method on the circle (<<corr_pert_phifem_circle_mult_dual_nh>>) and on the square (<<corr_pert_phifem_square_mult_dual_nh>>).

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_mult_dual_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_circle_mult_dual_nh.png[width=240.0,height=192.0]
|[[corr_pert_phifem_square_mult_dual_nh]]
.figure
image::corr/corr_pert/diff_eps/phifem_square_mult_dual_nh.png[width=240.0,height=192.0]

|===

*_Observation :_* It seems that by imposing the boundary conditions with the direct method, the errors are better when stem:[\epsilon] is a bit large, especially for stem:[\epsilon=1]. For the dual method, it seems also works for imposing boundary conditions. However, we can see that it can become slightly stagnant when stem:[\epsilon] is decreased. It's possible that changing the stabilization parameters could have an impact here.



== Results on the elevated problem

In this section, we aim to show numerically the interest of elevating the problem. To do this, we will consider the case of the circle with the solution defined in <<_first_problem>> and the case of the square with the solution defined in <<_problem>>. We will choose the homogeneous case (i.e. with stem:[\varphi=0]) with stem:[S=0.5] and set stem:[\epsilon=10^{-3}].

*Results with FEM :*

Here, we consider some of the cases considered above, in order to test the correction by multiplying on an elevating problem with FEM (theoretical result presented in xref:corr/subsec_1_subsubsec_2.adoc[Section "Correction by multiplying on an elevated problem"]). We will test this method on the circle (<<corr_pert_fem_circle_reh>> and <<corr_pert_fem_circle_reh_fig>>) and on the square (<<corr_pert_fem_square_reh>> and <<corr_pert_fem_square_reh_fig>>) for selected frequencies and by varying stem:[m].

[cols="a,a"]
|===
|[[corr_pert_fem_circle_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_fem_circle.png[width=300.0,height=240.0]
|[[corr_pert_fem_square_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_fem_square.png[width=300.0,height=240.0]

|===

[cols="a,a"]
|===
|[[corr_pert_fem_circle_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_fem_circle.png[width=240.0,height=192.0]
|[[corr_pert_fem_square_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_fem_square.png[width=240.0,height=192.0]

|===

*Observation :* The numerical results obtained on the circle in <<corr_pert_fem_circle_reh>> and on the square \ref{corr_pert_fem_square_reh}, seem to show that the higher we raise the problem, the better the error. Furthermore, as explained in xref:corr/subsec_2_subsubsec_1.adoc[Section "Comparison of correction methods"], we can see that by increasing stem:[m], the error converges to the error obtained with the correction by adding (because the solution itself converges to the solution obtained with the correction by adding). 

*Results with stem:[\phi]-FEM :*

Now we to test the correction by multiplying on an elevating problem with stem:[\phi]-FEM. We will test this method on the circle (<<corr_pert_phifem_circle_reh>> and <<corr_pert_phifem_circle_reh_fig>>) and on the square (<<corr_pert_phifem_square_reh>> and <<corr_pert_phifem_square_reh_fig>>) for selected frequencies and by varying stem:[m]. Here, we're using the same scheme as in the homogeneous case, i.e. we're not going to impose the boundary conditions using the direct or dual method. 

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_phifem_circle.png[width=300.0,height=240.0]
|[[corr_pert_phifem_square_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_phifem_square.png[width=300.0,height=240.0]

|===

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_phifem_circle.png[width=240.0,height=192.0]
|[[corr_pert_phifem_square_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_phifem_square.png[width=240.0,height=192.0]

|===

Now, we impose the boundary conditions using the dual method, always considering the circle (<<corr_pert_phifem_circle_dual_reh>> and <<corr_pert_phifem_circle_dual_reh_fig>>) and on the square (<<corr_pert_phifem_square_dual_reh>> and <<corr_pert_phifem_square_dual_reh_fig>>) for selected frequencies and by varying stem:[m].

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_dual_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_phifem_circle_dual.png[width=300.0,height=240.0]
|[[corr_pert_phifem_square_dual_reh]]
.figure
image::corr/corr_pert/rehaussement/tab_errors_phifem_square_dual.png[width=300.0,height=240.0]

|===

[cols="a,a"]
|===
|[[corr_pert_phifem_circle_dual_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_phifem_circle_dual.png[width=300.0,height=240.0]
|[[corr_pert_phifem_square_dual_reh_fig]]
.figure
image::corr/corr_pert/rehaussement/fig_phifem_square_dual.png[width=300.0,height=240.0]

|===

*_Observation :_* It would appear that, in the case of multiplication correction on an elevated problem, we are forced to impose the boundary conditions using one of the two methods, unlike multiplication correction without elevation. By imposing boundary conditions using the dual method, it seems that in the case where the frequency of the solution is greater than the frequency of the perturbation (for stem:[f>f_p]), we do reduce the error by increasing stem:[m], but it doesn't seem as efficient as in the case with FEM. Indeed, in all the cases considered here, correction by addition gives much better results. Moreover, for stem:[f< f_p], it would appear that the enhancement is the opposite of the expected effect.


[NOTE]
====
Note that the direct method is not applicable in the case of this problem because, as explained in the case of correction without elevation on a non-homogeneous problem, we are in some ways returning to the homogeneous problem. In fact, if we consider 
[stem]
++++
\hat{u}=(\hat{\phi}-g-m)C+(g+m)=(\tilde{\phi}-g)C+(g+m)
++++
with stem:[g=0] because we've placed ourselves in the homogeneous case, which amounts to solving the problem without elevation.
====

